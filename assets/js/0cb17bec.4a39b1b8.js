"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9495],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return u}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var d=a.createContext({}),l=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},m=function(e){var n=l(e.components);return a.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,d=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=l(t),u=i,h=p["".concat(d,".").concat(u)]||p[u]||c[u]||o;return t?a.createElement(h,r(r({ref:n},m),{},{components:t})):a.createElement(h,r({ref:n},m))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=p;var s={};for(var d in n)hasOwnProperty.call(n,d)&&(s[d]=n[d]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6606:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return d},default:function(){return u},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],s={sidebar_position:2},d="Server Installation",l={unversionedId:"getting-started/server-installation",id:"getting-started/server-installation",title:"Server Installation",description:"The procedure provided here describes installation on Red Hat Enterprise Linux Server 7.9 as detailed as possible. Some steps can vary depending on your server operating system, infrastructure and networking. All this is work in progress and Docker technology, which should streamline installation procedure, shall be implemented in near future.",source:"@site/docs/getting-started/server-installation.md",sourceDirName:"getting-started",slug:"/getting-started/server-installation",permalink:"/docs/getting-started/server-installation",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/getting-started/server-installation.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"System Overview",permalink:"/docs/getting-started/system-overview"},next:{title:"Spectrometer Client Installation",permalink:"/docs/getting-started/client-installation"}},m={},c=[{value:"Server infrastructure dependencies",id:"server-infrastructure-dependencies",level:2},{value:"Recommended server configuration",id:"recommended-server-configuration",level:2},{value:"NOMAD code installation",id:"nomad-code-installation",level:2},{value:"Configuration files",id:"config-files",level:2},{value:"NGINX configuration",id:"nginx-configuration",level:2},{value:"Configuration for HTTP",id:"configuration-for-http",level:3},{value:"Configuration for HTTPS",id:"configuration-for-https",level:3},{value:"Starting the server",id:"starting-the-server",level:2},{value:"Stopping the server",id:"stopping-the-server",level:2},{value:"Updating NOMAD code",id:"updating-nomad-code",level:2},{value:"Database backup &amp; restore",id:"database-backup--restore",level:2}],p={toc:c};function u(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"server-installation"},"Server Installation"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The procedure provided here describes installation on Red Hat Enterprise Linux Server 7.9 as detailed as possible. Some steps can vary depending on your server operating system, infrastructure and networking. All this is work in progress and ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://www.docker.com/"},"Docker"))," technology, which should streamline installation procedure, shall be implemented in near future."))),(0,o.kt)("h2",{id:"server-infrastructure-dependencies"},"Server infrastructure dependencies"),(0,o.kt)("p",null,"Here is the list of resources that should be installed on the server before you proceed with NOMAD code installation."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://linuxize.com/post/how-to-install-node-js-on-centos-7/"},"Node.js"))),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The latest LTS (long-term support) version should do the trick at the moment.\nUsing NVM (Node Version Manager) will allow easy upgrade in future if necessary.")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-centos-7"},"MongoDB")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://linuxize.com/post/how-to-install-nginx-on-centos-8/"},"NginX")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://pm2.keymetrics.io/"},"PM2")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://www.tecmint.com/install-git-centos-fedora-redhat/"},"Git"))),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Git is not strictly a dependency but at this stage will help to get NOMAD code on your server.\nIt's likely that Git has been already installed with your Linux distribution."))))),(0,o.kt)("h2",{id:"recommended-server-configuration"},"Recommended server configuration"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"4 vCPUs (cores)"),(0,o.kt)("li",{parentName:"ul"},"8GB RAM")),(0,o.kt)("h2",{id:"nomad-code-installation"},"NOMAD code installation"),(0,o.kt)("p",null,"Make installation folder using superuser privileges."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Nginx needs to have read permission to the files that should be served AND have execute permission in each of the parent directories along the path from the root to the served files."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo su\nmkdir /nomad\nchmod 701 /nomad\n")),(0,o.kt)("p",null,"Clone NOMAD code repositories, install Javascript dependencies and create production build of the front-code."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You need to create ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/docs/getting-started/server-installation/#config-files"},"configuration files"))," before you run ",(0,o.kt)("em",{parentName:"p"},"npm run build")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd /nomad\ngit clone https://github.com/nomad-nmr/nomad-front-end.git\ngit clone https://github.com/nomad-nmr/nomad-rest-api.git\ngit clone https://github.com/nomad-nmr/nomad-nmrium.git\ncd /nomad/nomad-rest-api\nnpm install\ncd /nomad/nomad-front-end\nnpm install\nnpm run build\ncd /nomad/nomad-nmrium\nnpm install\nnpm run build\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"NPM installation routine can throw list of various warnings that are for development purposes and don't necessarily mean that the code is broken."))),(0,o.kt)("h2",{id:"config-files"},"Configuration files"),(0,o.kt)("p",null,"Following configuration files needs to be created."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/nomad/nomad-front-end/config/production.env",title:"/nomad/nomad-front-end/config/production.env"},"SKIP_PREFLIGHT_CHECK=true\nPORT=3000\n\n#URL of the server running NOMAD back-end API and NMRium wrapper\nREACT_APP_API_URL=http://nomad.my-uni.ac.uk\nREACT_APP_NMRIUM_URL=http://nomad.my-uni.ac.uk/nmrium\n#Set true if corresponding NOMAD module is used\n#----------------------------------------------\n#Submission portal\nREACT_APP_SUBMIT_ON=true\n#Batch submission portal\nREACT_APP_BATCH_SUBMIT_ON=true\n#Datastore\nREACT_APP_DATASTORE_ON=true\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"REACT_APP_API_URL has to be set correctly in accordance with your server domain name and protocol prefix (http/https)!"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/nomad/nomad-nmrium/config/.env.production",title:"/nomad/nomad-nmrium/config/.env.production"},"VITE_APP_API_URL=http://nomad.my-uni.ac.uk\nVITE_APP_NOMAD_URL=http://nomad.my-uni.ac.uk\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title=/nomad/ecosystem.config.js",title:"/nomad/ecosystem.config.js"},"module.exports = {\n  apps: [\n    {\n      name: 'nomad-api',\n      script: './nomad-rest-api/app.js',\n      watch: '.',\n      env: {\n        PORT: 8080,\n        NODE_ENV: 'production',\n        MONGODB_URL: 'mongodb://127.0.0.1:27017/nomad',\n        FRONT_HOST_URL: 'http://nomad.my-uni.ac.uk',\n\n        //Password for automatically generated admin user\n        ADMIN_PASSWORD: 'MySuperSecretBackDoorPasswd',\n\n        // JWT expiration time in seconds\n        //After this time user automatically logs off\n        JWT_EXPIRATION: 3600,\n\n        //Secret word for generating JWT\n        JWT_SECRET: 'SecretWord',\n\n        EMAIL_SUFFIX: 'my-uni.ac.uk',\n\n        //SMTP configuration\n        SMTP_HOST: 'mailhost.my-uni.ac.uk',\n        SMTP_PORT: 25,\n        SMTP_SECURE: false,\n        SMTP_REQUIRE_TLS: true,\n        SMTP_USER: '',\n        SMTP_PASS: '',\n        SMTP_SENDER: 'nomad@my-uni.ac.uk',\n\n        //Set to true if NOMAD submission portal is used\n        SUBMIT_ON: true,\n\n        //Set true if NOMAD datastore is used\n        DATASTORE_ON: true,\n        DATASTORE_PATH: '/nomad/store/data',\n\n        //timeout for upload data route connection [ms].\n        DATA_UPLOAD_TIMEOUT: 30000,\n\n        //If true NMRium file is generated upon Bruker zip file upload.\n        //That results in bigger volume of data in datastore but faster viewing of data in NMRium\n        PREPROCESS_NMRIUM: true\n      }\n    }\n  ]\n}\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You can create default ecosystem.config.js file by command"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 ecosystem\n")))),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Pay attention to setting FRONT_HOST_URL and SMTP configuration. These entries are the most crucial for correct operation of the system.\nVery likely, you will need to request access to SMTP server run by IT services of your organisation."))),(0,o.kt)("h2",{id:"nginx-configuration"},"NGINX configuration"),(0,o.kt)("h3",{id:"configuration-for-http"},"Configuration for HTTP"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"{10-13,15-17,19-26} title=/etc/nginx/nginx.conf","{10-13,15-17,19-26}":!0,title:"/etc/nginx/nginx.conf"},'server {\n        listen          80 default_server;\n        listen          [::]:80 default_server;\n        server_name  nomad.my-uni.ac.uk;\n        root         /usr/share/nginx/html;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n                root /nomad/nomad-front-end/build;\n                try_files $uri /index.html =404;\n        }\n\n        location /data/ {\n          proxy_read_timeout 30s;\n          proxy_connect_timeout 75s;\n          proxy_pass http://127.0.0.1:8080/data/;\n          client_max_body_size 200M;\n        }\n\n        location /api/ {\n          proxy_pass http://127.0.0.1:8080/;\n       }\n\n        location /socket.io/ {\n            proxy_http_version 1.1;\n\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n\n           proxy_pass http://127.0.0.1:8080/socket.io/;\n        }\n\n        location /nmrium {\n           autoindex on;\n           index index.html;\n\n           alias /nomad/nomad-nmrium/dist;\n\n           try_files $uri $uri/ /index.html;\n       }\n\n        error_page 404 /404.html;\n        location = /404.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n        }\n}\n')),(0,o.kt)("h3",{id:"configuration-for-https"},"Configuration for HTTPS"),(0,o.kt)("p",null,"For running the server over HTTPS, TLS enabled server block has to be used and the default HTTP server block commented out. The three location blocks (/, /api/ and /socket.io) highlighted above need to be copied over and ssl_certificate and ssl_certificate_key have to be added. IT services in your organisation should be able to assist you to get the certificates."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"{9-10,19-22,24-26,28-35} title=/etc/nginx/nginx.conf","{9-10,19-22,24-26,28-35}":!0,title:"/etc/nginx/nginx.conf"},'# Settings for a TLS enabled server.\n\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  nomad.my-uni.ac.uk;\n        root         /usr/share/nginx/html;\n\n        ssl_certificate /root/ssl/my-certificate.crt;\n        ssl_certificate_key /root/ssl/my-certificate.key;\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n                root /nomad/nomad-front-end/build;\n                try_files $uri /index.html =404;\n        }\n\n        location /api/ {\n          proxy_pass http://127.0.0.1:8080/;\n       }\n\n        location /data/ {\n          proxy_read_timeout 30s;\n          proxy_connect_timeout 75s;\n          proxy_pass http://127.0.0.1:8080/data/;\n          client_max_body_size 200M;\n        }\n\n        location /socket.io/ {\n            proxy_http_version 1.1;\n\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n\n           proxy_pass http://127.0.0.1:8080/socket.io/;\n        }\n\n         location /nmrium {\n           autoindex on;\n           index index.html;\n\n           alias /nomad/nomad-nmrium/dist;\n\n           try_files $uri $uri/ /index.html;\n       }\n\n        error_page 404 /404.html;\n        location = /404.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n        }\n    }\n')),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you switch to HTTPS you need to set correct protocol prefix (https)"),(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"REACT_APP_API_URL")," (/nomad/nomad-front-end/config/production.env )"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"FRONT_HOST_URL")," (/nomad/ecosystem.config.js)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"VITE_APP_API_URL")," and ",(0,o.kt)("strong",{parentName:"li"},"*","VITE_APP_NOMAD_URL")," (/nomad/nomad-nmrium/config/.env.production)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"/docs/getting-started/client-installation/#config"},"Client configuration - serverAddress")))))),(0,o.kt)("h2",{id:"starting-the-server"},"Starting the server"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd /nomad\npm2 start ecosystem.config.js\nnginx\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"START NOMAD-API AT SERVER STARTUP")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You can set PM2 to start at server startup"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 startup\n")),(0,o.kt)("p",{parentName:"div"},"See ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://pm2.keymetrics.io/docs/usage/startup/"},"PM2 docs"))," for more details."))),(0,o.kt)("h2",{id:"stopping-the-server"},"Stopping the server"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"nginx -s quit\npm2 stop all\n")),(0,o.kt)("h2",{id:"updating-nomad-code"},"Updating NOMAD code"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd /nomad/nomad-rest-api\ngit pull\nnpm install\ncd /nomad/nomad-front-end\ngit pull\nnpm install\nnpm run build\ncd /nomad/nomad-nmrium\ngit pull\nnpm install\nnpm run build\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"GIT PULL FAILS")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If git pull command fails very likely some changes were done in the working directory by npm install command.\nIn that case, stash the changes and repeat pull."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git stash\ngit pull\n")))),(0,o.kt)("h2",{id:"database-backup--restore"},"Database backup & restore"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mongodump --db nomad --out /nomad/db-backup/\nmongorestore \u2013db nomad /nomad/db-backup\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Periodically create and backup db-backup folder on a different machine to improve resilience of your NOMAD system."))))}u.isMDXComponent=!0}}]);